<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang=""><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>NumericFunction.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Metaschema Core API</a> &gt; <a href="index.source.html" class="el_package">gov.nist.secauto.metaschema.core.metapath.function.library</a> &gt; <span class="el_source">NumericFunction.java</span></div><h1>NumericFunction.java</h1><pre class="source lang-java linenums">/*
 * SPDX-FileCopyrightText: none
 * SPDX-License-Identifier: CC0-1.0
 */

package gov.nist.secauto.metaschema.core.metapath.function.library;

import gov.nist.secauto.metaschema.core.metapath.DynamicContext;
import gov.nist.secauto.metaschema.core.metapath.ISequence;
import gov.nist.secauto.metaschema.core.metapath.function.FunctionUtils;
import gov.nist.secauto.metaschema.core.metapath.function.IArgument;
import gov.nist.secauto.metaschema.core.metapath.function.IFunction;
import gov.nist.secauto.metaschema.core.metapath.function.IFunctionExecutor;
import gov.nist.secauto.metaschema.core.metapath.item.IItem;
import gov.nist.secauto.metaschema.core.metapath.item.atomic.INumericItem;
import gov.nist.secauto.metaschema.core.util.ObjectUtils;

import java.net.URI;
import java.util.List;

import javax.xml.namespace.QName;

import edu.umd.cs.findbugs.annotations.NonNull;

/**
 * Provides a generic implementation of methods defined by &lt;a href=
 * &quot;https://www.w3.org/TR/xpath-functions-31/#numeric-value-functions&quot;&gt;XPath 3.1
 * Functions on numeric values&lt;/a&gt;.
 */
public final class NumericFunction implements IFunctionExecutor {

  @NonNull
  private final INumericExecutor executor;

  @NonNull
  static IFunction signature(@NonNull URI namespace, @NonNull String name, @NonNull INumericExecutor executor) {
<span class="fc" id="L37">    return signature(ObjectUtils.notNull(namespace.toASCIIString()), name, executor);</span>
  }

  @NonNull
  static IFunction signature(@NonNull String namespace, @NonNull String name, @NonNull INumericExecutor executor) {
<span class="fc" id="L42">    return IFunction.builder()</span>
<span class="fc" id="L43">        .name(name)</span>
<span class="fc" id="L44">        .namespace(namespace)</span>
<span class="fc" id="L45">        .deterministic()</span>
<span class="fc" id="L46">        .contextIndependent()</span>
<span class="fc" id="L47">        .focusIndependent()</span>
<span class="fc" id="L48">        .argument(IArgument.builder()</span>
<span class="fc" id="L49">            .name(&quot;arg1&quot;)</span>
<span class="fc" id="L50">            .type(INumericItem.class)</span>
<span class="fc" id="L51">            .zeroOrOne()</span>
<span class="fc" id="L52">            .build())</span>
<span class="fc" id="L53">        .returnType(INumericItem.class)</span>
<span class="fc" id="L54">        .returnZeroOrOne()</span>
<span class="fc" id="L55">        .functionHandler(newFunctionHandler(executor))</span>
<span class="fc" id="L56">        .build();</span>
  }

  @NonNull
  static IFunction signature(@NonNull QName qname, @NonNull INumericExecutor executor) {
<span class="nc" id="L61">    return signature(</span>
<span class="nc" id="L62">        ObjectUtils.requireNonNull(qname.getNamespaceURI(), &quot;the namespace URI must not be null&quot;),</span>
<span class="nc" id="L63">        ObjectUtils.requireNonNull(qname.getLocalPart(), &quot;the localpart must not be null&quot;),</span>
        executor);
  }

  @NonNull
  static NumericFunction newFunctionHandler(@NonNull INumericExecutor executor) {
<span class="fc" id="L69">    return new NumericFunction(executor);</span>
  }

<span class="fc" id="L72">  private NumericFunction(@NonNull INumericExecutor executor) {</span>
<span class="fc" id="L73">    this.executor = executor;</span>
<span class="fc" id="L74">  }</span>

  @Override
  public ISequence&lt;INumericItem&gt; execute(@NonNull IFunction function,
      @NonNull List&lt;ISequence&lt;?&gt;&gt; arguments,
      @NonNull DynamicContext dynamicContext,
      IItem focus) {

<span class="nc" id="L82">    ISequence&lt;? extends INumericItem&gt; sequence = FunctionUtils.asType(</span>
<span class="nc" id="L83">        ObjectUtils.requireNonNull(arguments.get(0)));</span>
<span class="nc bnc" id="L84" title="All 2 branches missed.">    if (sequence.isEmpty()) {</span>
<span class="nc" id="L85">      return ISequence.empty(); // NOPMD - readability</span>
    }

<span class="nc" id="L88">    INumericItem item = sequence.getFirstItem(true);</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">    if (item == null) {</span>
<span class="nc" id="L90">      return ISequence.empty(); // NOPMD - readability</span>
    }

<span class="nc" id="L93">    INumericItem result = executor.execute(item);</span>
<span class="nc" id="L94">    return ISequence.of(result);</span>
  }

  @FunctionalInterface
  public interface INumericExecutor {
    /**
     * Perform the execution using the provided {@code item}.
     *
     * @param item
     *          the item to operate on
     * @return the numeric result from the execution
     */
    @NonNull
    INumericItem execute(@NonNull INumericItem item);
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>